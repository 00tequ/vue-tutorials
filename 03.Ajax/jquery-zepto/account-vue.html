<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="style.css" />
	</head>

	<body>

		<div id="app">
			<div class="container">
				<span>User Name:{{ userName }}</span>
			</div>
			<div class="container">
				<div class="left">
					<div class="form-group">
						<label>Email</label>
						<input type="text" v-model="registerModel.email" />
					</div>
					<div class="form-group">
						<label>Password</label>
						<input type="text" v-model="registerModel.password" />
					</div>

					<div class="form-group">
						<label>Confirm Password</label>
						<input type="text" v-model="registerModel.confirmPassword" />
					</div>

					<div class="form-group">
						<label></label>
						<button id="register" @click="register">Register</button>
					</div>
					<div class="message">
						{{ msg }}
					</div>
				</div>
				<div class="right">
					<div class="form-group">
						<label>Email</label>
						<input type="text" v-model="loginModel.username" />
					</div>
					<div class="form-group">
						<label>Password</label>
						<input type="text" v-model="loginModel.password" />
					</div>
					<div class="form-group">
						<label></label>
						<button @click="login">Login</button>
					</div>
					<div>
						Access Token: <span id="accessToken"> {{ accessToken }}</span>
					</div>
				</div>
			</div>

			<div class="container">
				<div class="form-group">
					<button @click="callApi">Call API</button>
				</div>
			</div>
		</div>
		<template id="dialog-template">
			<div class="dialogs">
				<div class="dialog" v-bind:class="{ 'dialog-active': show }">
					<div class="dialog-content">
						<div class="close rotate">
							<span class="iconfont icon-close" @click="close"></span>
						</div>
						<slot name="header"></slot>
						<slot name="body"></slot>
						<slot name="footer"></slot>
					</div>
				</div>
				<div class="dialog-overlay"></div>
			</div>
		</template>
	</body>
	<script src="js/vue.js"></script>
	<script src="js/zepto.js"></script>
	<script src="js/ajax-helper.js"></script>
	<script>
		Vue.component('modal-dialog', {
			template: '#dialog-template',
			props: ['show'],
			methods: {
				close: function() {
					this.show = false
				}
			}
		})

		var ajaxHelper = new AjaxHelper()
		var demo = new Vue({
			el: '#app',
			data: {
				show: false,
				registerUrl: 'http://localhost:64474/api/Account/Register',
				loginUrl: 'http://localhost:64474/token',
				apiUrl: 'http://localhost:64474/api/values',
				registerModel: {
					email: '',
					password: '',
					confirmPassword: ''
				},
				loginModel: {
					username: '',
					password: '',
					grant_type: 'password'
				},
				msg: '',
				accessToken: '',
				userName: ''
			},
			methods: {
				register: function() {
					var vm = this
					callback = function() {
						vm.msg = "register successfully!"
					}
					ajaxHelper.post(vm.registerUrl, vm.registerModel, callback)
				},
				login: function() {

					var vm = this
					callback = function(data) {
						console.log(data)
						vm.userName = data.userName
						vm.accessToken = data.access_token
						vm.msg = "login successfully!"
					}
					ajaxHelper.post(vm.loginUrl, vm.loginModel, callback)
				},
				callApi: function() {
					var vm = this
					headers = {}
					headers.Authorization = 'Bearer ' + vm.accessToken;

					$.ajax({
						type: 'get',
						dataTye: 'json',
						url: vm.apiUrl,
						headers:headers,
						success: function(data){
							alert(data)
							console.log(data)
						},
						error: function(xhr, errorType, error){
							alert('Ajax request error!')
						}
					})
				}
			}
		})
	</script>

</html>